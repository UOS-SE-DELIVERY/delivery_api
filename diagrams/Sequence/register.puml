@startuml RegisterSequence
skinparam shadowing false
skinparam roundcorner 8
skinparam sequence {
  ArrowColor #444
  LifeLineBorderColor #777
  LifeLineBackgroundColor #FBFBFF
  ParticipantBorderColor #555
  ParticipantBackgroundColor #FFFFFF
  ActorBorderColor #555
  ActorBackgroundColor #FFFFFF
  BoxBorderColor #999
}

autonumber
actor Guest
participant "client:WebApp" as fe
participant "view:RegisterView" as regv
participant "serializer:RegisterSerializer" as regsz
participant "customer:Customer" as customer
participant ":db" as db

Guest -> fe : Fill form {username, password, profile_consent, real_name?, phone?, address?}
fe -> regv : POST /auth/register (JSON)
activate regv
regv -> regsz : validate(payload)
alt invalid payload
  regsz --> regv : ValidationError {field_errors}
  regv --> fe : 400 Bad Request {errors}
  deactivate regv
  fe -> fe : showValidationErrors(errors)
else valid
  regsz --> regv : validated
  regv -> customer : create(payload)
  customer -> db : INSERT Customer
  db --> customer : customer_id
  customer --> regv : instance
  regv --> fe : 201 Created {message:"ok", customer_id}
  deactivate regv
  fe -> fe : redirect("/auth/login")
end
@enduml